apiVersion: tekton.dev/v1beta1
kind: Task
metadata:
  name: nose
spec:
  description: Run unit tests with nose
  workspaces:
    - name: source
  params:
    - name: args
      type: string
      default: "-v --with-spec --spec-color"
    - name: database_uri
      type: string
      default: "sqlite:///test.db"
  steps:
    - name: test
      image: python:3.9-alpine
      workingDir: $(workspaces.source.path)
      env:
        - name: DATABASE_URI
          value: $(params.database_uri)
      script: |
        #!/bin/sh
        set -e
        pip install --no-cache-dir -q -r requirements.txt
        nosetests $(params.args)
